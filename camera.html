<!-- //====================== CAMERA SIDE  ===========================
///////=============================================================== -->

<!DOCTYPE html>

<html>
	<head>
		<!-- <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'> -->
		<link href="style.css" type="text/css" rel="stylesheet" />

		<script src="js/gumhelper.js" defer></script>
		<script src="js/Animated_GIF.js" defer></script>
		<script src="js/videoShooter.js" defer></script>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

		<script src="https://cdn.socket.io/socket.io-1.2.1.js"></script>

		<script type="text/javascript">

			var socket = io.connect('/');

			socket.on('connect', function() {
				console.log("Connected to the server!");
			});

			function init() {
				var videoContainer = document.getElementById('video');
				var gifContainer = document.getElementById('gifContainer');
				var videoWidth= 0, videoHeight = 0;
				var videoElement;
				var shooter;

				document.getElementById('captureButton').addEventListener('click', startGifCapture);

				GumHelper.startVideoStreaming(function(error, stream, videoEl, width, height) {
					if(error) {
						alert('Cannot open the camera. Make sure to allow the camera, or try refreshing the page.' + error.message);
						return;
					}

					videoElement = videoEl;
					videoElement.width = width;
					videoElement.height = height;
					videoWidth = width;
					videoHeight = height;

					videoContainer.appendChild(videoElement);

					shooter = new VideoShooter(videoElement);
				});


				function startGifCapture() {
					socket.emit('captureStarted');
					// 30 is the total number of frames it takes... you can change that
					// 0.2 is how often it takes a new frame .. i.e. 0.2 seconds... you can change taht
					shooter.getShot(onFrameCaptured, 10, 0.25, function onProgress(progress) {
						console.log(progress); //let's you know the current progress of the gif capture
					});
				}

				function onFrameCaptured(pictureData) {
					console.log("GIF IS DONE!")

					//send pictureData to the server to be saved!
					socket.emit('gif', pictureData);
				}
			}

			window.addEventListener('DOMContentLoaded', init);

		</script>

	</head>


	<body>
		<div id="stripe"> </div>

		<div id="header">
			<h1> SNAP A GIF </h1>
		</div>

		<div id ="camera">

			<div id="video-holder">
				<div id="video"></div>
			</div>

			<div id="button-div">	
				<button id="captureButton" class="buttons">Start Capture</button>
			</div>
		
		</div>

	</body>

</html>







